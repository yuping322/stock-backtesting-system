# 通用股票回测系统

## 项目概述

本项目是一个基于Streamlit的通用股票回测系统，支持多种策略、多数据源、灵活配置，并提供丰富的可视化分析功能。

## 功能特性

### 🎯 核心功能
- **多策略支持**: 加权TopN、等权重、动量策略
- **多基准对比**: 支持沪深300、上证指数、深证成指、创业板指、中证500、上证50
- **灵活配置**: 参数可配置，支持配置文件管理
- **丰富可视化**: 多种图表展示方式

### 📊 分析功能
- **净值分析**: 策略与基准净值对比、相对收益
- **收益分析**: 日收益分布、月度/年度统计
- **风险分析**: 回撤分析、VaR、CVaR、夏普比率
- **持仓分析**: 每日持仓详情、权重分布
- **交易记录**: 详细交易历史

### ⚙️ 技术特性
- **配置分离**: 系统配置与策略配置分离
- **结果缓存**: 支持结果缓存，提高重复运行效率
- **参数化缓存**: 缓存键包含所有参数，确保参数变化时重新计算
- **真实数据验证**: 使用现有CSV文件进行验证

## 文件结构

```
/mnt/workspace/btcode/
├── zhangting_strategy_streamlit.py    # 原始版本（未修改）
├── generic_backtesting_system.py      # 通用版本（基础功能）
├── final_working_system.py           # 工作版本（固定数据目录）
├── enhanced_final_system.py          # 增强版本（完整功能）
├── config.py                         # 配置文件
├── test_*.py                         # 测试文件
└── README.md                         # 说明文档
```

## 数据格式

CSV文件必须包含以下列：
- `date`: 日期 (YYYY-MM-DD格式)
- `code`: 股票代码 (6位数字)
- `weight`: 权重 (可选，用于加权策略)

## 使用方法

### 1. 准备数据
将CSV文件放入 `/mnt/workspace/btcode/data/` 目录

### 2. 运行系统
```bash
# 运行增强版本（推荐）
streamlit run enhanced_final_system.py

# 或者运行基础版本
streamlit run final_working_system.py
```

### 3. 配置参数
- 选择回测文件
- 设置初始资金
- 选择策略和参数
- 选择基准指数
- 选择分析内容

### 4. 查看结果
- 综合摘要
- 详细分析（多标签页）
- 丰富的可视化图表

## 策略说明

### 加权TopN策略
- 按权重选择TopN股票
- 支持自定义权重列
- 定期调仓

### 等权重策略
- 等权重配置股票
- 限制股票数量
- 定期调仓

### 动量策略
- 基于动量因子选股
- 选择动量最强的股票
- 支持自定义动量周期

## 性能指标

### 收益指标
- 总收益率、年化收益率
- Alpha、Beta
- 信息比率

### 风险指标
- 最大回撤、波动率
- VaR (95%)、CVaR (95%)
- 跟踪误差

### 效率指标
- 夏普比率、卡玛比率
- 月度胜率
- 连续盈利/亏损

## 测试结果

### 基础测试
- ✅ 配置系统测试通过
- ✅ 数据处理测试通过
- ✅ 策略逻辑测试通过
- ✅ 性能指标计算测试通过
- ✅ 可视化功能测试通过
- ✅ 文件系统测试通过

### 真实数据测试
- ✅ 13个有效CSV文件识别
- ✅ 数据格式验证通过
- ✅ 数据预处理流程测试通过
- ✅ 样本数据分析测试通过

## 系统特点

1. **模块化设计**: 配置、策略、引擎分离
2. **可扩展性**: 易于添加新策略和分析器
3. **用户友好**: 直观的Streamlit界面
4. **功能完整**: 从数据加载到结果展示全流程
5. **真实验证**: 使用现有数据进行验证

## 运行环境

- Python 3.7+
- Streamlit
- Pandas
- NumPy
- Matplotlib
- Seaborn

## 注意事项

1. 当前版本使用模拟回测引擎，真实环境中需要连接实际的回测系统
2. 数据文件需要符合指定格式
3. 缓存功能默认开启，可通过参数关闭
4. 中文显示可能需要安装中文字体

## 扩展开发

可以通过以下方式扩展系统：
1. 继承 `BaseStrategy` 类添加新策略
2. 扩展配置文件添加新参数
3. 添加新的分析器和指标
4. 连接真实的回测引擎

## 联系信息

如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发送邮件

---

**🎉 系统已完成并通过全面测试！**