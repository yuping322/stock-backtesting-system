# 股票回测系统

## 项目概述

这是一个完整的股票回测系统，基于Backtrader和Streamlit构建，支持多种交易策略、实时数据获取和丰富的分析功能。

## 功能特性

### 🎯 核心功能
- **多策略支持**: 加权TopN、等权重、动量策略
- **多基准对比**: 支持沪深300、上证指数、深证成指、创业板指、中证500、上证50
- **实时数据**: 集成AKShare获取实时股票和指数数据
- **灵活配置**: 参数可配置，支持配置文件管理
- **丰富可视化**: 多种图表展示方式

### 📊 分析功能
- **净值分析**: 策略与基准净值对比、相对收益
- **收益分析**: 日收益分布、月度/年度统计
- **风险分析**: 回撤分析、VaR、CVaR、夏普比率
- **持仓分析**: 每日持仓详情、权重分布
- **交易记录**: 详细交易历史
- **Alpha分析**: 集成Alphalens进行因子分析

### ⚙️ 技术特性
- **Backtrader引擎**: 基于成熟的Backtrader回测框架
- **配置分离**: 系统配置与策略配置分离
- **结果缓存**: 支持结果缓存，提高重复运行效率
- **参数化缓存**: 缓存键包含所有参数，确保参数变化时重新计算
- **真实数据验证**: 使用AKShare实时数据

## 文件结构

```
/mnt/workspace/clean_stock_backtest/
├── integrated_backtesting_system.py    # 集成版回测系统（主文件，2113行）
├── backtrader_base_strategy.py         # Backtrader基础策略（1098行）
├── data.py                             # 数据处理模块（53173行）
├── config.py                           # 配置文件（10495行）
├── requirements.txt                    # 依赖包列表
├── all_a_stocks.csv                    # 股票数据文件
├── start.sh                           # 启动脚本
├── data/                               # 数据目录
│   ├── *.csv                         # 股票数据CSV文件
│   ├── best_config_*.json            # 最优配置缓存
│   ├── *predicted_tomorrow_result.json # 预测结果
│   └── selected_stocks_*_result.json  # 选股结果
├── logs/                               # 日志目录
├── __pycache__/                        # Python缓存
└── README.md                           # 说明文档
```

## 数据源

- **AKShare**: 实时获取股票和指数数据
- **本地CSV**: 支持导入本地股票数据文件
- **缓存机制**: 自动缓存计算结果提高效率

## 使用方法

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 运行系统
```bash
# 方法一：使用启动脚本（推荐）
./start.sh

# 方法二：直接运行
streamlit run integrated_backtesting_system.py
```

### 3. 配置参数
- 选择回测文件或使用实时数据
- 设置初始资金和交易费用
- 选择策略和参数
- 选择基准指数
- 选择分析内容

### 4. 查看结果
- 综合摘要
- 详细分析（多标签页）
- 丰富的可视化图表
- Alpha因子分析

## 策略说明

### 加权TopN策略
- 按权重选择TopN股票
- 支持自定义权重列
- 定期调仓

### 等权重策略
- 等权重配置股票
- 限制股票数量
- 定期调仓

### 动量策略
- 基于动量因子选股
- 选择动量最强的股票
- 支持自定义动量周期

## 性能指标

### 收益指标
- 总收益率、年化收益率
- Alpha、Beta
- 信息比率

### 风险指标
- 最大回撤、波动率
- VaR (95%)、CVaR (95%)
- 跟踪误差

### 效率指标
- 夏普比率、卡玛比率
- 月度胜率
- 连续盈利/亏损

## 技术栈

- **Python 3.7+**: 主要编程语言
- **Backtrader**: 回测引擎
- **Streamlit**: Web界面
- **Pandas/NumPy**: 数据处理
- **Matplotlib/Seaborn**: 数据可视化
- **AKShare**: 金融数据获取
- **Alphalens**: 因子分析

## 系统特点

1. **模块化设计**: 配置、策略、引擎分离
2. **可扩展性**: 易于添加新策略和分析器
3. **用户友好**: 直观的Streamlit界面
4. **功能完整**: 从数据加载到结果展示全流程
5. **实时数据**: 支持AKShare实时数据获取
6. **专业分析**: 集成Alphalens因子分析

## 运行环境

- Python 3.7+
- 参见requirements.txt完整依赖列表

## 注意事项

1. 需要网络连接以获取AKShare实时数据
2. 数据文件需要符合指定格式
3. 缓存功能默认开启，可通过参数关闭
4. 首次运行需要下载数据，可能较慢
5. 启动脚本包含OSS环境变量配置，可根据需要修改

## 扩展开发

可以通过以下方式扩展系统：
1. 继承 `BaseStrategy` 类添加新策略
2. 扩展配置文件添加新参数
3. 添加新的分析器和指标
4. 集成其他数据源（Tushare、Baostock等）
5. 添加机器学习模型
6. 支持更多技术指标和因子
7. 添加风险控制模块
8. 集成实时交易接口

---

**🎉 系统功能完整，支持实时数据回测和专业分析！**